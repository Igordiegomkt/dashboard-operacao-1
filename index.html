<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>DASHBOARD_Opera√ß√£o_1 ‚Äî Tempo Real</title>

  <style>
    :root {
      --bg: #0f1115;
      --card: #151823;
      --muted: #8b93a7;
      --text: #e5e7ef;
      --accent: #6aa3ff;
      --igor: #00ff95;
      --julio: #ffd166;
      --bad: #ff6b6b;
    }
    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0; background: var(--bg); color: var(--text);
      font: 15px/1.45 ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, "Helvetica Neue", Arial;
      display: grid; place-items: start center;
    }
    .wrap { width: min(1100px, 92vw); padding: 20px; }
    .header { display: grid; gap: 6px; margin-bottom: 12px; }
    .title {
      font-size: 20px; font-weight: 700; letter-spacing: .5px;
      display: flex; align-items: center; gap: 10px;
    }
    .dot { width: 10px; height: 10px; border-radius: 999px; background: var(--igor); box-shadow: 0 0 10px var(--igor); }
    .sub { color: var(--muted); font-size: 13px; display: flex; gap: 10px; flex-wrap: wrap; }
    .card {
      background: linear-gradient(0deg, rgba(255,255,255,.03), rgba(255,255,255,.03)), var(--card);
      border: 1px solid rgba(255,255,255,.06);
      border-radius: 14px;
      padding: 14px 14px 8px;
      box-shadow: 0 10px 30px rgba(0,0,0,.25), inset 0 1px rgba(255,255,255,.04);
    }
    .toolbar { display: flex; gap: 8px; align-items: center; margin-bottom: 8px; }
    button {
      background: rgba(255,255,255,.06); color: var(--text);
      border: 1px solid rgba(255,255,255,.12);
      padding: 8px 10px; border-radius: 10px; cursor: pointer;
      font-weight: 600; letter-spacing: .2px;
    }
    button:hover { background: rgba(255,255,255,.1); }
    .status { margin-left: auto; color: var(--muted); font-size: 12px; }
    pre {
      margin: 0; padding: 14px; border-radius: 10px;
      background: #0c0f17; border: 1px solid rgba(255,255,255,.06);
      white-space: pre-wrap; word-break: break-word;
      font: 14px/1.6 ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace;
    }
    .hint { color: var(--muted); font-size: 12px; margin-top: 8px; }
    .igor { color: var(--igor); font-weight: 600; }
    .julio { color: var(--julio); font-weight: 600; }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="header">
      <div class="title">
        <span class="dot" id="live-dot"></span>
        DASHBOARD_Opera√ß√£o_1 ‚Äî Tempo Real
      </div>
      <div class="sub">
        <span>Fonte: <code>public.dashboard_operacao_1</code></span>
        <span>Atualiza a cada <strong id="intervalLabel">10s</strong></span>
        <span>Fuso: <strong>America/Sao_Paulo</strong></span>
      </div>
    </div>

    <div class="card">
      <div class="toolbar">
        <button id="refreshBtn">Atualizar agora</button>
        <button id="pauseBtn">Pausar</button>
        <div class="status" id="statusText">‚åõ carregando‚Ä¶</div>
      </div>
      <pre id="panelText">Carregando painel‚Ä¶</pre>
      <div class="hint">Painel atualiza automaticamente a cada 10 segundos.</div>
    </div>
  </div>

  <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
  <script>
    const SUPABASE_URL = "https://atexvoxukvaqittpqkov.supabase.co";
    const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImF0ZXh2b3h1a3ZhcWl0dHBxa292Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjA1NTYyNjAsImV4cCI6MjA3NjEzMjI2MH0.HptK9KRkqkSQL3jrwAwH0rOSDGhlXOTwGwGqjwNgtU4";

    const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    const VIEW_NAME = "dashboard_operacao_1";
    let COL_NAME = null;

    const panelText = document.getElementById('panelText');
    const statusText = document.getElementById('statusText');
    const refreshBtn = document.getElementById('refreshBtn');
    const pauseBtn = document.getElementById('pauseBtn');
    const liveDot = document.getElementById('live-dot');
    let TIMER_MS = 10000;
    let timerId = null;
    let paused = false;

    function setStatus(msg) {
      statusText.textContent = msg;
    }

    async function detectColumn() {
      const { data, error } = await supabase.from(VIEW_NAME).select('*').limit(1);
      if (error) throw error;
      if (data && data.length > 0) {
        const keys = Object.keys(data[0]);
        const txtCol = keys.find(k => typeof data[0][k] === 'string');
        if (txtCol) COL_NAME = txtCol;
      }
    }

    async function fetchPanel() {
      try {
        if (!COL_NAME) await detectColumn();
        setStatus('üîÑ atualizando‚Ä¶');
        const { data, error } = await supabase.from(VIEW_NAME).select('*').limit(1);
        if (error) throw error;
        if (!data || data.length === 0) {
          panelText.textContent = '‚ö†Ô∏è Nenhum dado encontrado.';
        } else {
          const row = data[0];
          const content = row[COL_NAME] ?? '(sem conte√∫do)';
          panelText.innerHTML = content
            .replace(/üë§ IGOR/g, '<span class="igor">üë§ IGOR</span>')
            .replace(/üë§ JULIO/g, '<span class="julio">üë§ JULIO</span>');
        }
        const when = new Date().toLocaleString('pt-BR', { timeZone: 'America/Sao_Paulo' });
        setStatus('üü¢ √öltima atualiza√ß√£o: ' + when);
      } catch (err) {
        console.error(err);
        setStatus('‚ùå erro ao atualizar');
        panelText.textContent = 'Erro: ' + (err?.message || err);
        liveDot.style.background = 'var(--bad)';
        liveDot.style.boxShadow = '0 0 10px var(--bad)';
      }
    }

    function startAuto() {
      if (timerId) clearInterval(timerId);
      timerId = setInterval(fetchPanel, TIMER_MS);
    }

    refreshBtn.addEventListener('click', fetchPanel);
    pauseBtn.addEventListener('click', () => {
      paused = !paused;
      if (paused) {
        clearInterval(timerId);
        pauseBtn.textContent = 'Retomar';
        setStatus('‚è∏Ô∏è atualiza√ß√£o pausada');
        liveDot.style.background = '#999';
      } else {
        startAuto();
        pauseBtn.textContent = 'Pausar';
        fetchPanel();
      }
    });

    fetchPanel();
    startAuto();
  </script>
</body>
</html>
